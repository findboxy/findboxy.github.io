<!DOCTYPE html>
<html>
<head>
    <title>Find Boxy!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        body {
            font-family: 'Fredoka One', cursive;
            text-align: center;
            margin: 0;
            padding: 0;
            background:#1A1A4E;
            color: #FFFFFF;
            overflow: hidden;
        }
        canvas {
            border: 2px solid #FFFFFF;
            margin: 10px;
            background: linear-gradient(135deg, #2E1A47, #1A1A4E);
        }
        button {
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            background: #FF6F61;
            color: #FFFFFF;
            border: none;
            border-radius: 5px;
            font-family: 'Fredoka One', cursive;
        }
        button:hover {
            background: #FF3B2F;
        }
        .screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
        }
        .screen.active {
            display: block;
        }
        #message {
            font-size: 24px;
            font-weight: bold;
            margin: 20px;
            color: #FFD700;
        }
        #level {
            font-size: 20px;
            margin: 10px;
            color: #FF6F61;
        }
        #timer {
            font-size: 20px;
            margin: 10px;
            color: #00FFCC;
        }
        #boxySpeech {
            font-size: 20px;
            margin: 10px;
            color: #FFD700;
            font-style: italic;
        }
        #startScreen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #startScreen h1 {
            font-size: 64px;
            margin: 10px;
            color: #FFD700;
        }
        #startScreen p {
            font-size: 20px;
            margin: 10px;
            color: #FFFFFF;
        }
        #stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #FFFFFF;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 3s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen" class="screen active">
        <h1>FIND BOXY</h1>
        <p>a colour memory game by Zac Kenny</p>
        <button onclick="startGame()">PLAY</button>
    </div>

    <!-- Screen 1: BoxyGrid -->
    <div id="screen1" class="screen">
        <h1>Welcome to Find Boxy!</h1>
        <div id="boxySpeech">Remember my colours!</div>
        <canvas id="boxyGrid" width="100" height="100"></canvas>
        <br>
        <button onclick="showGridCanvas()">Next</button>
        <div id="timer">Time: 0.00s</div>
    </div>

    <!-- Screen 2: GridCanvas -->
    <div id="screen2" class="screen">
        <h1>Find Boxy in the Grid!</h1>
        <div id="level">Level 1 - Grid Size: 6x6</div>
        <canvas id="gridCanvas" width="400" height="400"></canvas>
        <div id="message"></div>
        <button onclick="resetGame()">Restart Game</button>
        <div id="timer">Time: 0.00s</div>
    </div>

    <!-- Screen 3: Final Screen -->
    <div id="screen3" class="screen">
        <h1>Congratulations! ðŸŽ‰</h1>
        <p>You found Boxy in all levels!</p>
        <div id="finalTime"></div>
        <button onclick="resetGame()">Play Again</button>
    </div>

    <!-- Twinkling Stars -->
    <div id="stars"></div>

    <script>
        const boxyGridCanvas = document.getElementById('boxyGrid');
        const boxyCtx = boxyGridCanvas.getContext('2d');
        const gridCanvas = document.getElementById('gridCanvas');
        const gridCtx = gridCanvas.getContext('2d');
        const messageDiv = document.getElementById('message');
        const levelDiv = document.getElementById('level');
        const timerDiv = document.getElementById('timer');
        const finalTimeDiv = document.getElementById('finalTime');
        const boxySpeechDiv = document.getElementById('boxySpeech');
        const starsDiv = document.getElementById('stars');
        const startScreen = document.getElementById('startScreen');

        let gridSize = 6; // Starting grid size (6x6)
        let level = 1; // Starting level
        let boxyColors = []; // Stores the colors of the 2x2 BoxyGrid
        let boxyPosition = { x: 0, y: 0 }; // Position of BoxyGrid in the larger grid
        let timer = 0; // Timer in seconds (with decimals)
        let totalTime = 0; // Cumulative time across all levels
        let timerInterval = null; // Interval for the timer

        // Generate random colors for BoxyGrid
        function generateBoxyGrid() {
            boxyColors = [];
            for (let row = 0; row < 2; row++) {
                for (let col = 0; col < 2; col++) {
                    const color = getRandomColor();
                    boxyColors.push(color);
                    boxyCtx.fillStyle = color;
                    boxyCtx.fillRect(col * 50, row * 50, 50, 50);
                }
            }
        }

        // Generate the grid with BoxyGrid hidden somewhere
        function generateGridCanvas() {
            const squareSize = gridCanvas.width / gridSize; // Calculate square size dynamically
            gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);

            // Randomly place BoxyGrid in the larger grid
            boxyPosition.x = Math.floor(Math.random() * (gridSize - 1));
            boxyPosition.y = Math.floor(Math.random() * (gridSize - 1));

            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    // Check if this is part of BoxyGrid
                    if (row >= boxyPosition.y && row < boxyPosition.y + 2 &&
                        col >= boxyPosition.x && col < boxyPosition.x + 2) {
                        const index = (row - boxyPosition.y) * 2 + (col - boxyPosition.x);
                        gridCtx.fillStyle = boxyColors[index];
                    } else {
                        gridCtx.fillStyle = getRandomColor();
                    }
                    gridCtx.fillRect(col * squareSize, row * squareSize, squareSize - 1, squareSize - 1);
                }
            }

            // Update level label
            levelDiv.textContent = `Level ${level} - Grid Size: ${gridSize}x${gridSize}`;
        }

        // Start the timer
        function startTimer() {
            timer = 0; // Reset the timer for the current level
            timerInterval = setInterval(() => {
                timer += 0.01; // Increment by 0.01 seconds (10ms)
                timerDiv.textContent = `Time: ${(totalTime + timer).toFixed(2)}s`; // Show cumulative time
            }, 10); // Update every 10ms
        }

        // Stop the timer
        function stopTimer() {
            clearInterval(timerInterval);
        }

        // Reset the timer
        function resetTimer() {
            stopTimer();
            timer = 0;
            totalTime = 0;
            timerDiv.textContent = `Time: 0.00s`;
        }

        // Check if the user clicked on BoxyGrid
        function checkClick(event) {
            const rect = gridCanvas.getBoundingClientRect();
            const squareSize = gridCanvas.width / gridSize;
            const x = Math.floor((event.clientX - rect.left) / squareSize);
            const y = Math.floor((event.clientY - rect.top) / squareSize);

            if (x >= boxyPosition.x && x < boxyPosition.x + 2 &&
                y >= boxyPosition.y && y < boxyPosition.y + 2) {
                messageDiv.textContent = "You found me!";
                messageDiv.style.color = "#FFD700";
                stopTimer(); // Stop the timer when the user wins
                totalTime += timer; // Add the level time to the total time

                if (level === 12) {
                    // Show final screen after Level 12
                    showFinalScreen();
                } else {
                    setTimeout(() => {
                        level++;
                        gridSize++;
                        showBoxyScreen(); // Return to Boxy screen for the next level
                    }, 1000); // Wait 1 second before advancing to the next level
                }
            } else {
                messageDiv.textContent = "Keep Looking!";
                messageDiv.style.color = "#FF6F61";
            }
        }

        // Show the final screen with total time
        function showFinalScreen() {
            document.getElementById('screen2').classList.remove('active');
            document.getElementById('screen3').classList.add('active');
            finalTimeDiv.textContent = `Total Time: ${totalTime.toFixed(2)}s`;
        }

        // Reset the game to the initial state
        function resetGame() {
            gridSize = 6;
            level = 1;
            totalTime = 0;
            resetTimer(); // Reset the timer
            showBoxyScreen();
            messageDiv.textContent = "";
            document.getElementById('screen3').classList.remove('active');
        }

        // Helper function to generate random colors
        function getRandomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return `rgb(${r},${g},${b})`;
        }

        // Switch to the Boxy screen
        function showBoxyScreen() {
            document.getElementById('screen1').classList.add('active');
            document.getElementById('screen2').classList.remove('active');
            generateBoxyGrid(); // Generate a new Boxy for the next level
            boxySpeechDiv.textContent = "Remember my colours!";
        }

        // Switch to the grid canvas screen
        function showGridCanvas() {
            document.getElementById('screen1').classList.remove('active');
            document.getElementById('screen2').classList.add('active');
            generateGridCanvas();
            startTimer(); // Start the timer when the grid screen is shown
            gridCanvas.addEventListener('click', checkClick);
        }

        // Start the game from the start screen
        function startGame() {
            startScreen.classList.remove('active'); // Hide the start screen
            showBoxyScreen(); // Show the Boxy screen
        }

        // Create twinkling stars
        function createStars() {
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                starsDiv.appendChild(star);
            }
        }

        // Initialize the game
        createStars();
    </script>
</body>
</html>